(window.webpackJsonp=window.webpackJsonp||[]).push([[484],{979:function(s,a,t){"use strict";t.r(a);var n=t(30),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx反向代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"}},[s._v("#")]),s._v(" Nginx反向代理")]),s._v(" "),t("h2",{attrs:{id:"_1-什么是反向代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是反向代理"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"}},[s._v("#")]),s._v(" 1. 什么是反向代理")]),s._v(" "),t("p",[s._v("当我们有一个服务器集群，并且服务器集群中的每台服务器的内容一样的时候，同样我们要直接从个人电脑访问到服务器集群服务器的时候无法访问，必须通过第三方服务器才能访问集群")]),s._v(" "),t("p",[s._v("这个时候，我们通过第三方服务器访问服务器集群的内容，但是我们并不知道是哪一台服务器提供的内容，此种代理方式称为反向代理。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/images-1/71.png",alt:"image"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/assets/images-1/72.png",alt:"image"}})]),s._v(" "),t("h3",{attrs:{id:"反向代理优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反向代理优点"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%BC%98%E7%82%B9"}},[s._v("#")]),s._v(" 反向代理优点")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("保护网站安全，所有请求都先经过代理服务器。")])]),s._v(" "),t("li",[t("p",[s._v("负载均衡，把请求转发到压力较小的服务器。")])]),s._v(" "),t("li",[t("p",[s._v("可以做一些中间层设置，比如缓存静态资源")])])]),s._v(" "),t("h2",{attrs:{id:"_2-nginx基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-nginx基础"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_2-nginx%E5%9F%BA%E7%A1%80"}},[s._v("#")]),s._v(" 2. Nginx基础")]),s._v(" "),t("h3",{attrs:{id:"_2-1-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_2-1-%E5%AE%89%E8%A3%85"}},[s._v("#")]),s._v(" 2.1 安装")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    brew install nginx\n    nginx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 显示版本号则安装成功")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-2-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-命令"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_2-2-%E5%91%BD%E4%BB%A4"}},[s._v("#")]),s._v(" 2.2 命令")]),s._v(" "),t("p",[s._v("nginx目录")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    nginx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 显示nginx配置信息")]),s._v("\n    cd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("启动nginx")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    nginx "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 默认8080端口启动成功，可访问http://localhost:8080/")]),s._v("\n    servive nginx start "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ubantu下")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("关闭nginx")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    nginx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s stop\n    servive nginx stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ubantu下")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("重启nginx")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    nginx "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s reload "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 每次修改完nginx.conf文件就需要重启nginx")]),s._v("\n    servive nginx restart "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ubantu下")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_3-nginx配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-nginx配置"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_3-nginx%E9%85%8D%E7%BD%AE"}},[s._v("#")]),s._v(" 3. Nginx配置")]),s._v(" "),t("h3",{attrs:{id:"_3-1-了解nginx配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-了解nginx配置"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_3-1-%E4%BA%86%E8%A7%A3nginx%E9%85%8D%E7%BD%AE"}},[s._v("#")]),s._v(" 3.1 了解Nginx配置")]),s._v(" "),t("p",[s._v("先看个简单的案例了解下nginx配置：")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    ########### 每个指令必须有分号结束。#################\n    http "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        access_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 记录日志地址\n        # 日志格式\n        log_format combined "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] '")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"$request\" $status $body_bytes_sent '")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_referer" "$http_user_agent"\'')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        # 可以有多个server\n        server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" #监听"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v("端口\n            server_name "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" #监听地址  \n            root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("up1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # server根目录。未设置时，MacOS默认是"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www\n    \n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                proxy_pass http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 代理\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 设置该路径下的根目录（覆盖server根目录）\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n            # 接口\n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logout "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                default_type application"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("json"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                add_header Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                add_header Access"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Allow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{\"code\":200}'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ht "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  #禁止访问 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htxxx 文件\n               deny all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("do_not_delete"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" #直接简单粗暴的返回状态码及内容文本\n               "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("h3",{attrs:{id:"_3-2-location配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-location配置"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_3-2-location%E9%85%8D%E7%BD%AE"}},[s._v("#")]),s._v(" 3.2 location配置")]),s._v(" "),t("p",[s._v("重点看下location配置")]),s._v(" "),t("p",[s._v("语法规则： location [=|~|~*|^~] /uri/ { … }")]),s._v(" "),t("ul",[t("li",[s._v("= 开头表示精确匹配")]),s._v(" "),t("li",[s._v("~ 开头表示区分大小写的正则匹配")]),s._v(" "),t("li",[s._v("~*  开头表示不区分大小写的正则匹配")]),s._v(" "),t("li",[s._v("^~ 开头表示uri以某个常规字符串开头")])]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 监听"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("端口\n    \n        # http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("some"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html访问"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("some"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n        # http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html访问"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html\n        # 注意：这里不是访问"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n        # http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png访问"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" \\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"_3-3-负载均衡-反向代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-负载均衡-反向代理"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_3-3-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"}},[s._v("#")]),s._v(" 3.3 负载均衡（反向代理）")]),s._v(" "),t("ol",[t("li",[s._v("用户输入http://test-openai.com 时，访问80端口")]),s._v(" "),t("li",[s._v("nginx监听到80端口被访问，匹配到的/路径，被反向代理到http://dramatic-offical-website")]),s._v(" "),t("li",[s._v("dramatic-offical-website集群管理着一堆机器地址，从而实现负载均衡。")]),s._v(" "),t("li",[s._v("如果匹配到http://test-openai.com/images/ 路径，则直接映射/data下的文件")])]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    # 虚拟主机配置\n    server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server_name test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("openai"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 请求到达的服务器名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("定义使用test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("openai"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com访问"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 监听"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("端口\n        listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # https默认端口是"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    \n        # 对 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 所有做负载均衡"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("反向代理\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_pass http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dramatic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("offical"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("website"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 代理到目标地址\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n        # 静态文件，nginx自己处理\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 映射到"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    # 设定负载均衡后台服务器列表\n    upstream dramatic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("offical"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("website "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.192")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".106")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".133")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.192")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".106")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".134")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"_3-4-nginx-conf-配置文件全解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-nginx-conf-配置文件全解析"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_3-4-nginx-conf-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%85%A8%E8%A7%A3%E6%9E%90"}},[s._v("#")]),s._v(" 3.4 nginx.conf 配置文件全解析")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    #运行用户\n    #user somebody"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #启动进程"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("通常设置成和cpu的数量相等\n    worker_processes  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #全局错误日志\n    error_log  "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    error_log  "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("notice"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  notice"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    error_log  "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PID")]),s._v("文件，记录当前启动的nginx的进程"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ID")]),s._v("\n    pid        "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #工作模式及连接数上限\n    events "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        worker_connections "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    #单个后台worker process进程的最大并发链接数\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    #设定http服务器，利用它的反向代理功能提供负载均衡支持\n    http "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("#设定mime类型")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("邮件支持类型"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("类型由mime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types文件定义\n        include       "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        default_type  application"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        #设定日志\n        log_format  main  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[$remote_addr] - [$remote_user] [$time_local] \"$request\" '")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        access_log    "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        rewrite_log     on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        #sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，\n        #必须设为 on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("如果用来进行下载等应用磁盘"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IO")]),s._v("重负载应用，可设置为 off，以平衡磁盘与网络"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("O")]),s._v("处理速度，降低系统的uptime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        sendfile        on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        #tcp_nopush     on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        #连接超时时间\n        keepalive_timeout  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        tcp_nodelay        on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        #gzip压缩开关\n        #gzip  on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n        #设定实际的服务器列表\n        upstream zp_server1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8089")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n        #"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v("服务器\n        server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            #监听"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("端口，"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("端口是知名端口号，用于"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v("协议\n            listen       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n            #定义使用www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com访问\n            server_name  www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("helloworld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n            #首页\n            index index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html\n    \n            #指向webapp的目录\n            root "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\01_Workspace\\Project\\github\\zp\\SpringNotes\\spring"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("security\\spring"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("shiro\\src\\main\\webapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n            #编码格式\n            charset utf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n            #代理配置参数\n            proxy_connect_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_send_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_read_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header Host $host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_set_header "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("X")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarder"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For $remote_addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n            #反向代理的路径（和upstream绑定），location 后面设置映射的路径\n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                proxy_pass http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zp_server1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n            #静态文件，nginx自己处理\n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("images"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("javascript"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("flash"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("media"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                root "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\01_Workspace\\Project\\github\\zp\\SpringNotes\\spring"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("security\\spring"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("shiro\\src\\main\\webapp\\views"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                #过期"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("天，静态文件不怎么更新，过期可以设大一点，如果频繁更新，则可以设置得小一点。\n                expires 30d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n            #设定查看Nginx状态的地址\n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("NginxStatus "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                stub_status           on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                access_log            on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                auth_basic            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NginxStatus"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                auth_basic_user_file  conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("htpasswd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n            #禁止访问 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htxxx 文件\n            location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ht "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                deny all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n            #错误处理页面（可选择性配置）\n            #error_page   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            #error_page   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            #location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            #    root   html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            #"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br")])]),t("p",[s._v("内置全局变量：")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    $args ：这个变量等于请求行中的参数，同$query_string\n    $content_length ： 请求头中的Content"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("length字段。\n    $content_type ： 请求头中的Content"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type字段。\n    $document_root ： 当前请求在root指令中指定的值。\n    $host ： 请求主机头字段，否则为服务器名称。\n    $http_user_agent ： 客户端agent信息\n    $http_cookie ： 客户端cookie信息\n    $limit_rate ： 这个变量可以限制连接速率。\n    $request_method ： 客户端请求的动作，通常为"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v("或"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POST")]),s._v("。\n    $remote_addr ： 客户端的"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("地址。\n    $remote_port ： 客户端的端口。\n    $remote_user ： 已经经过Auth Basic Module验证的用户名。\n    $request_filename ： 当前请求的文件路径，由root或alias指令与"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URI")]),s._v("请求生成。\n    $scheme ： "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v("方法（如http，https）。\n    $server_protocol ： 请求使用的协议，通常是"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("或"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("。\n    $server_addr ： 服务器地址，在完成一次系统调用后可以确定这个值。\n    $server_name ： 服务器名称。\n    $server_port ： 请求到达服务器的端口号。\n    $request_uri ： 包含请求参数的原始"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URI")]),s._v("，不包含主机名，如：”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("foo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("arg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("baz”。\n    $uri ： 不带请求参数的当前"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URI")]),s._v("，$uri不包含主机名，如”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("foo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html”。\n    $document_uri ： 与$uri相同。\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h2",{attrs:{id:"_4-总结技巧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-总结技巧"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#_4-%E6%80%BB%E7%BB%93%E6%8A%80%E5%B7%A7"}},[s._v("#")]),s._v(" 4. 总结技巧")]),s._v(" "),t("ul",[t("li",[s._v("deny")]),s._v(" "),t("li",[s._v("gzip")]),s._v(" "),t("li",[s._v("add_header")])]),s._v(" "),t("h3",{attrs:{id:"防盗链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防盗链"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#%E9%98%B2%E7%9B%97%E9%93%BE"}},[s._v("#")]),s._v(" 防盗链")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("swf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        valid_referers none blocked start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("igrow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn sta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("igrow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("$invalid_referer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            rewrite "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"根据文件类型设置过期时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#根据文件类型设置过期时间"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#%E6%A0%B9%E6%8D%AE%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"}},[s._v("#")]),s._v(" 根据文件类型设置过期时间")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("js"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("swf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f $request_filename"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            expires 1h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"禁止访问某个目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#禁止访问某个目录"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#%E7%A6%81%E6%AD%A2%E8%AE%BF%E9%97%AE%E6%9F%90%E4%B8%AA%E7%9B%AE%E5%BD%95"}},[s._v("#")]),s._v(" 禁止访问某个目录")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("txt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wwwroot"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("linuxtone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        deny all"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"gzip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gzip"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#gzip"}},[s._v("#")]),s._v(" gzip")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    #gzip on"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off\n    gzip  on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("#消息体太小就没必要压缩")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("这里设置最小范围1K"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    gzip_min_length  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    \n    #Nginx做为反向代理的时候启用，\n    #param"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("off"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("expired"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sotre"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("no_last_modified"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("no_etag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("any"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    #expample"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("gzip_proxied no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #off – 关闭所有的代理结果数据压缩\n    #expired – 启用压缩，如果header中包含”Expires”头信息\n    #no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cache – 启用压缩，如果header中包含”Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cache”头信息\n    #no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("store – 启用压缩，如果header中包含”Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("store”头信息\n    #"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" – 启用压缩，如果header中包含”Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v("”头信息\n    #no_last_modified – 启用压缩，如果header中包含”Last_Modified”头信息\n    #no_etag – 启用压缩，如果header中包含“ETag”头信息\n    #auth – 启用压缩，如果header中包含“Authorization”头信息\n    #any – 无条件压缩所有结果数据\n    \n    gzip_proxied     any"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #Nginx作为反向代理的时候启用，开启或者关闭后端服务器返回的结果，匹配的前提是后端服务器必须要返回包含"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Via"')]),s._v("的 header头。\n    gzip_proxied expired no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cache no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("store "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #压缩比例，比例越大，压缩时间越长。\n    #默认是"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n    #建议 nginx gzip级别为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n    gzip_comp_level  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #哪些文件可以被压缩\n    gzip_types       text"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("plain text"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html text"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("javascript text"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml text"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("css application"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("javascript application"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xml"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    #无视"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IE6")]),s._v("这个笨蛋\n    gzip_disable  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MSIE [1-6]\\."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("h3",{attrs:{id:"负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    upstream mysvr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        #weigth参数表示权值，权值越高被分配到的几率越大\n        server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3128")]),s._v(" weight"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("#本机上的Squid开启"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3128")]),s._v("端口\n        server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  weight"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("3x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("  weight"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysvr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_set_header Host $host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("X")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v(" $remote_addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("X")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For $proxy_add_x_forwarded_for"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_pass http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysvr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$request_uri"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"内容控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内容控制"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#%E5%86%85%E5%AE%B9%E6%8E%A7%E5%88%B6"}},[s._v("#")]),s._v(" 内容控制")]),s._v(" "),t("p",[s._v("http头控制")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    add_header 这个指令用来增加协议头：\n    add_header Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    add_header Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    add_header Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    add_header Content"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Encoding gzip\n    add_header Content"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text/html; charset=utf-8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("$request_uri "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^/$|^/search/.+/|^/company/.+/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        add_header    Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control  max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("$request_uri "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^/search-suggest/|^/categories/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        add_header    Cache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control  max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("直接简单粗暴的返回状态码及内容文本：")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("do_not_delete"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"ssl-https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssl-https"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"#ssl-https"}},[s._v("#")]),s._v(" SSL HTTPS")]),s._v(" "),t("div",{staticClass:"language-JS line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("    server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        charset utf8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_certificate "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_certificate_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);
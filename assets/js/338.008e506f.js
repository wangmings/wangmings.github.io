(window.webpackJsonp=window.webpackJsonp||[]).push([[338],{833:function(s,e,a){"use strict";a.r(e);var t=a(30),o=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"requess模块处理cookie相关的请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requess模块处理cookie相关的请求"}},[s._v("#")]),s._v(" requess模块处理cookie相关的请求")]),s._v(" "),a("h5",{attrs:{id:"学习目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习目标"}},[s._v("#")]),s._v(" 学习目标")]),s._v(" "),a("ul",[a("li",[a("ol",[a("li",[s._v("掌握requests处理cookie的三种方法")])])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_1-爬虫中使用cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-爬虫中使用cookie"}},[s._v("#")]),s._v(" 1 爬虫中使用cookie")]),s._v(" "),a("blockquote",[a("p",[s._v("为了能够通过爬虫获取到登录后的页面，或者是解决通过cookie的反扒，需要使用request来处理cookie相关的请求")])]),s._v(" "),a("h5",{attrs:{id:"_1-1-爬虫中使用cookie的利弊"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-爬虫中使用cookie的利弊"}},[s._v("#")]),s._v(" 1.1 爬虫中使用cookie的利弊")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("带上cookie的好处")]),s._v(" "),a("ul",[a("li",[s._v("能够访问登录后的页面")]),s._v(" "),a("li",[s._v("能够实现部分反反爬")])])]),s._v(" "),a("li",[a("p",[s._v("带上cookie的坏处")]),s._v(" "),a("ul",[a("li",[s._v("一套cookie往往对应的是一个用户的信息，请求太频繁有更大的可能性被对方识别为爬虫")]),s._v(" "),a("li",[s._v("那么上面的问题如何解决 ?使用多个账号")])])])]),s._v(" "),a("h5",{attrs:{id:"_1-2-requests处理cookie的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-requests处理cookie的方法"}},[s._v("#")]),s._v(" 1.2 requests处理cookie的方法")]),s._v(" "),a("p",[s._v("使用requests处理cookie有三种方法：")]),s._v(" "),a("ol",[a("li",[s._v("cookie字符串放在headers中")]),s._v(" "),a("li",[s._v("把cookie字典放传给请求方法的cookies参数接收")]),s._v(" "),a("li",[s._v("使用requests提供的session模块")])]),s._v(" "),a("h3",{attrs:{id:"_2-cookie添加在heades中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-cookie添加在heades中"}},[s._v("#")]),s._v(" 2 cookie添加在heades中")]),s._v(" "),a("h5",{attrs:{id:"_2-1-headers中cookie的位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-headers中cookie的位置"}},[s._v("#")]),s._v(" 2.1 headers中cookie的位置")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/headers%E4%B8%AD%E7%9A%84cookie.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("headers中的cookie：\n"),a("ul",[a("li",[s._v("使用分号(;)隔开")]),s._v(" "),a("li",[s._v("分号两边的类似a=b形式的表示一条cookie")]),s._v(" "),a("li",[s._v("a=b中，a表示键（name），b表示值（value）")]),s._v(" "),a("li",[s._v("在headers中仅仅使用了cookie的name和value")])])])]),s._v(" "),a("h5",{attrs:{id:"_2-2-cookie的具体组成的字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-cookie的具体组成的字段"}},[s._v("#")]),s._v(" 2.2 cookie的具体组成的字段")]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/images/cookie%E7%9A%84%E5%85%B7%E4%BD%93%E5%AD%97%E6%AE%B5.png",alt:""}})]),s._v(" "),a("p",[s._v("由于headers中对cookie仅仅使用它的name和value，所以在代码中我们仅仅需要cookie的name和value即可")]),s._v(" "),a("h5",{attrs:{id:"_2-3-在headers中使用cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-在headers中使用cookie"}},[s._v("#")]),s._v(" 2.3 在headers中使用cookie")]),s._v(" "),a("p",[s._v("复制浏览器中的cookie到代码中使用")]),s._v(" "),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("headers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"User-Agent"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Cookie"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" Pycharm-26c2d973=dbb9b300-2483-478f-9f5a-16ca4580177e; Hm_lvt_98b9d8c2fd6608d564bf2ac2ae642948=1512607763; Pycharm-26c2d974=f645329f-338e-486c-82c2-29e2a0205c74; _xsrf=2|d1a3d8ea|c5b07851cbce048bd5453846445de19d|1522379036"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nrequests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[s._v("#")]),s._v(" 注意：")]),s._v(" "),a("p",[s._v("cookie有过期时间 ，所以直接复制浏览器中的cookie可能意味着下一程序继续运行的时候需要替换代码中的cookie，对应的我们也可以通过一个程序专门来获取cookie供其他程序使用；当然也有很多网站的cookie过期时间很长，这种情况下，直接复制cookie来使用更加简单")]),s._v(" "),a("h3",{attrs:{id:"_3-使用cookies参数接收字典形式的cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用cookies参数接收字典形式的cookie"}},[s._v("#")]),s._v(" 3 使用cookies参数接收字典形式的cookie")]),s._v(" "),a("ul",[a("li",[s._v("cookies的形式：字典")])]),s._v(" "),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("cookies "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cookie的name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cookie的value"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("使用方法：")])]),s._v(" "),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("cookies"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cookie_dict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-使用requests-session处理cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用requests-session处理cookie"}},[s._v("#")]),s._v(" 4 使用requests.session处理cookie")]),s._v(" "),a("blockquote",[a("p",[s._v("前面使用手动的方式使用cookie，那么有没有更好的方法在requets中处理cookie呢？")])]),s._v(" "),a("p",[s._v("requests 提供了一个叫做session类，来实现客户端和服务端的"),a("code",[s._v("会话保持")])]),s._v(" "),a("p",[s._v("会话保持有两个内涵：")]),s._v(" "),a("ul",[a("li",[s._v("保存cookie，下一次请求会带上前一次的cookie")]),s._v(" "),a("li",[s._v("实现和服务端的长连接，加快请求速度")])]),s._v(" "),a("h5",{attrs:{id:"_4-1-使用方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-使用方法"}},[s._v("#")]),s._v(" 4.1 使用方法")]),s._v(" "),a("div",{staticClass:"language-Python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("session "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nresponse "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("session实例在请求了一个网站后，对方服务器设置在本地的cookie会保存在session中，下一次再使用session请求对方服务器的时候，会带上前一次的cookie")]),s._v(" "),a("h5",{attrs:{id:"_4-2-动手练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-动手练习"}},[s._v("#")]),s._v(" 4.2 动手练习：")]),s._v(" "),a("p",[s._v("动手尝试使用session来登录人人网： "),a("a",{attrs:{href:"http://www.renren.com/PLogin.do",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www.renren.com/PLogin.do"),a("OutboundLink")],1),s._v(" (先不考虑这个url地址从何而来)，请求体的格式："),a("code",[s._v('{"email":"username", "password":"password"}')])]),s._v(" "),a("h5",{attrs:{id:"思路分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思路分析"}},[s._v("#")]),s._v(" 思路分析")]),s._v(" "),a("ol",[a("li",[s._v("准备url地址和请求参数")]),s._v(" "),a("li",[s._v("构造session发送post请求")]),s._v(" "),a("li",[s._v("使用session请求个人主页，观察是否请求成功")])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_5-小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-小结"}},[s._v("#")]),s._v(" 5 小结")]),s._v(" "),a("ol",[a("li",[s._v("cookie字符串可以放在headers字典中，键为Cookie，值为cookie字符串")]),s._v(" "),a("li",[s._v("可以把cookie字符串转化为字典，使用请求方法的cookies参数接收")]),s._v(" "),a("li",[s._v("使用requests提供的session模块，能够自动实现cookie的处理，包括请求的时候携带cookie，获取响应的时候保存cookie")])])])}),[],!1,null,null,null);e.default=o.exports}}]);
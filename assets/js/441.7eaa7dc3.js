(window.webpackJsonp=window.webpackJsonp||[]).push([[441],{936:function(s,t,a){"use strict";a.r(t);var n=a(30),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"electron工程踩坑记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#electron工程踩坑记录"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#electron%E5%B7%A5%E7%A8%8B%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95"}},[s._v("#")]),s._v(" Electron工程踩坑记录")]),s._v(" "),a("blockquote",[a("p",[s._v("最近公司有个新产品线，需要将应用打包成客户端，提供私有化部署。考虑到Web线上已经实现大部分需求，技术选型使用Electron。本文不是帮助读者的扫盲文，只是记录下项目工程中遇到的坑，所以阅读本文需要web和electron知识。")])]),s._v(" "),a("p",[s._v("应产品要求，私有化部署主要考虑windows端，mac端其次。框架选型使用"),a("a",{attrs:{href:"https://github.com/SimulatedGREG/electron-vue",target:"_blank",rel:"noopener noreferrer"}},[s._v("electron-vue (opens new window)"),a("OutboundLink")],1),s._v("脚手架(这里也强烈推荐)，该脚手架包含Vue技术栈单页应用 + electron + 打包完整流程。内置Vuex，Vue-Router，Webpack，electron-builder等。下面的大部分实践"),a("a",{attrs:{href:"https://github.com/lq782655835/electron-vue-template",target:"_blank",rel:"noopener noreferrer"}},[s._v("源码放在这 (opens new window)"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_1-自定义标题栏"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义标题栏"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_1-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E9%A2%98%E6%A0%8F"}},[s._v("#")]),s._v(" 1. 自定义标题栏")]),s._v(" "),a("p",[s._v("这应该是每一个使用electron实现web客户端都会遇到的问题，使用原生的外边框，第一太丑，第二也不统一。")]),s._v(" "),a("p",[s._v("解决方案：frame + css drag")]),s._v(" "),a("p",[a("code",[s._v("frame: false")]),s._v(": 主进程中设置窗体参数。去掉默认的标题栏")]),s._v(" "),a("p",[a("code",[s._v("-webkit-app-region: drag")]),s._v(": 渲染进程中设置css。对应的组件可以进行拖动了")]),s._v(" "),a("div",{staticClass:"language-JS line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    mainWindow "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BrowserWindow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("height")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("350")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("width")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("550")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("useContentSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("resizable")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" isDev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否可调整大小")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("alwaysOnTop")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("isDev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 应用是否始终在所有顶层之上")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("transparent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 透明边框")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("frame")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不使用默认边框")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("center")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("div",{staticClass:"language-JS line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("u"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("header "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("position")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" relative"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("width")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("height")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 50px"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        line"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("height"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 50px"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("webkit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("region"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" drag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* as window header */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"_2-标题栏按钮无效-only-windows"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-标题栏按钮无效-only-windows"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_2-%E6%A0%87%E9%A2%98%E6%A0%8F%E6%8C%89%E9%92%AE%E6%97%A0%E6%95%88-only-windows"}},[s._v("#")]),s._v(" 2. 标题栏按钮无效 -- only windows")]),s._v(" "),a("p",[s._v("该bug只在windows平台上显示，mac上正常。在header组件中设置为drag，导致组件里的元素都无法点击。")]),s._v(" "),a("p",[s._v("解决方案：在需要点击的元素上添加no-drag。"),a("code",[s._v("-webkit-app-region: no-drag;")]),s._v("详细看此"),a("a",{attrs:{href:"https://github.com/electron/electron/issues/1354",target:"_blank",rel:"noopener noreferrer"}},[s._v("issue (opens new window)"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_3-自定义标题栏无法实现css-hover-only-windows"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-自定义标题栏无法实现css-hover-only-windows"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_3-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E9%A2%98%E6%A0%8F%E6%97%A0%E6%B3%95%E5%AE%9E%E7%8E%B0css-hover-only-windows"}},[s._v("#")]),s._v(" 3. 自定义标题栏无法实现css hover -- only windows")]),s._v(" "),a("p",[s._v("当设置了为drag时，在windows上会屏蔽所有的鼠标事件,所以hover不起作用。这是一个由操作系统导致的问题，故无法修复，相关"),a("a",{attrs:{href:"https://github.com/electron/electron/issues/13534",target:"_blank",rel:"noopener noreferrer"}},[s._v("issue (opens new window)"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("解决方案：去掉"),a("code",[s._v("-webkit-app-region: drag;")]),s._v("即可。")]),s._v(" "),a("blockquote",[a("p",[s._v("如果要同时保留可拖动并且hover上有变化，在windows暂时无法实现，需要对此进行取舍或改变交互设计。")])]),s._v(" "),a("h2",{attrs:{id:"_4-打包后程序调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-打包后程序调试"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_4-%E6%89%93%E5%8C%85%E5%90%8E%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95"}},[s._v("#")]),s._v(" 4. 打包后程序调试")]),s._v(" "),a("p",[s._v("electron-vue在开发环境默认启用electron-debug插件开启调试。但打包完成，交付到测试同学手里，需要在错误的时候打开开发者工具定位问题。")]),s._v(" "),a("p",[s._v("解决方案：通过注册快捷键，调开web的开发者模式。")]),s._v(" "),a("div",{staticClass:"language-JS line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    globalShortcut"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("register")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CommandOrControl+Shift+L'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" focusWin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" BrowserWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFocusedWindow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        focusWin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" focusWin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toggleDevTools")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_5-文本不可选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-文本不可选择"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_5-%E6%96%87%E6%9C%AC%E4%B8%8D%E5%8F%AF%E9%80%89%E6%8B%A9"}},[s._v("#")]),s._v(" 5. 文本不可选择")]),s._v(" "),a("p",[s._v("既然作为客户端，就应该像个客户端程序，不能对展示型的文本进行用户选择。")]),s._v(" "),a("p",[s._v("解决方案：使用css "),a("code",[s._v("-webkit-user-select: none;")])]),s._v(" "),a("div",{staticClass:"language-JS line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("webkit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("highlight"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("color"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" transparent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("webkit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("adjust"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("height")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("webkit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("select"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* disable user select text */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"_6-打包参数设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-打包参数设置"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_6-%E6%89%93%E5%8C%85%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"}},[s._v("#")]),s._v(" 6. 打包参数设置")]),s._v(" "),a("p",[s._v("electron应用需要进行打包，变成exe可执行文件给用户。推荐使用最新的electron-builder进行打包（electron-vue脚手架中有提供该选项）。这里对常用的设置进行说明")]),s._v(" "),a("div",{staticClass:"language-JS line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("scripts")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 打包成windows系统 **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node .electron-vue/build.js && electron-builder --win"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 打包成macos系统 **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"build:mac"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node .electron-vue/build.js && electron-builder --mac"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 最终可执行文件名称：${productName}-${version}.${ext} **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"productName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sight-electron-app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"appId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sight.controller"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 压缩形式，默认normal;store打包最快，适合测试;maximum打包体积最小，适合生产模式 **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"compression"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"maximum"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 是否将多个文件合并为tar风格的归档模式 **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"asar"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"directories"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"output"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 打包结果目标地址 **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"files"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/electron/**/*"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 需要打包的文件地址 **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** 不同平台设置 **/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"mac"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"icon"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build/icons/icon.icns"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"win"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"icon"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build/icons/icon.ico"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"linux"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"icon"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build/icons"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h2",{attrs:{id:"_7-触摸板放大缩小-only-mac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-触摸板放大缩小-only-mac"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_7-%E8%A7%A6%E6%91%B8%E6%9D%BF%E6%94%BE%E5%A4%A7%E7%BC%A9%E5%B0%8F-only-mac"}},[s._v("#")]),s._v(" 7. 触摸板放大缩小 -- only mac")]),s._v(" "),a("p",[s._v("在macOS系统中，触摸板的放大缩小手指指令，会导致electron程序内的webFrame内容也跟着放大缩小。")]),s._v(" "),a("p",[s._v("解决方案：在renderer进程中设置其缩放范围"),a("code",[s._v("require('electron').webFrame.setZoomLevelLimits(1, 1)")])]),s._v(" "),a("h2",{attrs:{id:"_8-web端唤起本地客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-web端唤起本地客户端"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_8-web%E7%AB%AF%E5%94%A4%E8%B5%B7%E6%9C%AC%E5%9C%B0%E5%AE%A2%E6%88%B7%E7%AB%AF"}},[s._v("#")]),s._v(" 8. web端唤起本地客户端")]),s._v(" "),a("p",[s._v("electron提供该API能力："),a("code",[s._v("app.setAsDefaultProtocolClient(protocol[, path, args])")])]),s._v(" "),a("h2",{attrs:{id:"_9-禁止多开窗口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-禁止多开窗口"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_9-%E7%A6%81%E6%AD%A2%E5%A4%9A%E5%BC%80%E7%AA%97%E5%8F%A3"}},[s._v("#")]),s._v(" 9. 禁止多开窗口")]),s._v(" "),a("p",[s._v("多次双击window 的exe文件，会开启多个窗口；mac下默认开1个，但通过命令还是可以多开。")]),s._v(" "),a("p",[s._v("解决方案：判断单实例："),a("code",[s._v("app.makeSingleInstance(callback)")])]),s._v(" "),a("div",{staticClass:"language-JS line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 防止应用多开。bugfix:sholudQuit总是返回true，故暂时注释以下代码\n     * 当进程是第一个实例时，返回false。\n     * 如果是第二个实例时，返回true，并且执行第一个实例的回调函数\n     */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" shouldQuit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("makeSingleInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("commandLine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" workingDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mainWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            mainWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isMinimized")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" mainWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("restore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            mainWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("focus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shouldQuit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("quit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"_10-网络状态检测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-网络状态检测"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_10-%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B"}},[s._v("#")]),s._v(" 10. 网络状态检测")]),s._v(" "),a("p",[s._v("客户端经常遇见断网情况处理，当网络断开时需要给用户提示，当网络连接时继续服务。通常web情况下是采取"),a("code",[s._v("轮询")]),s._v("服务器方式，但这种方式比较消耗服务器性能。这里可以利用electron的node工具包"),a("code",[s._v("public-ip")]),s._v("进行判断。public-ip查询dns获取公网ip地址，如果能拿到值表示联网正常。本来到此可以很好的解决，但产品要求的客户端，"),a("strong",[s._v("既要提供公共部署，也需要进行无外网情况下的私有化部署")]),s._v("。")]),s._v(" "),a("p",[s._v("解决方案："),a("code",[s._v("public-ip + 轮询")]),s._v("方式。优先进行公网IP查询，如果成立则返回网络状态良好，如果查询不到再进行服务器心跳检查。实现方式参考"),a("a",{attrs:{href:"https://github.com/sindresorhus/is-online",target:"_blank",rel:"noopener noreferrer"}},[s._v("is-online (opens new window)"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_11-日志监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-日志监听"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_11-%E6%97%A5%E5%BF%97%E7%9B%91%E5%90%AC"}},[s._v("#")]),s._v(" 11. 日志监听")]),s._v(" "),a("p",[s._v("每个系统的异常监控都必不可少，特别是私有化部署客户端这种模式，日志记录显得必不可少。由于electron拥有node的环境，结合window.onerror收集错误信息,前端把日志记录在本地文件。当出现问题时，用户可以直接把日志文件发给开发者，从而定位原因。如果是网络版模式，可以通过Ajax收集错误信息。如果是程序异常崩溃，window.onerror可能没法监测的到，好在electron提供了CrashReporter收集")]),s._v(" "),a("p",[s._v("解决方案：推荐"),a("a",{attrs:{href:"https://github.com/megahertz/electron-log",target:"_blank",rel:"noopener noreferrer"}},[s._v("electron-log (opens new window)"),a("OutboundLink")],1),s._v(" + "),a("a",{attrs:{href:"https://thorsten-hans.com/electron-crashreporter-stay-up-to-date-if-your-app-fucked-up-3e9a989cd0a0",target:"_blank",rel:"noopener noreferrer"}},[s._v("CrashReporter (opens new window)"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-JS line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'electron-log'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    \n    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("level "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'info'")]),s._v("\n    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("format "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{h}:{i}:{s}:{ms} {text}'")]),s._v("\n    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("maxSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n    log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("level "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    \n    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"_12-自动更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-自动更新"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"#_12-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0"}},[s._v("#")]),s._v(" 12. 自动更新")]),s._v(" "),a("p",[s._v("该需求停留在调研，这篇"),a("a",{attrs:{href:"https://segmentfault.com/a/1190000007616641",target:"_blank",rel:"noopener noreferrer"}},[s._v("文章 (opens new window)"),a("OutboundLink")],1),s._v("讲的非常详细,待实践好再来续更")]),s._v(" "),a("p",[s._v("最后，附上@changkun的electron深度总结思维导图，总结的非常棒，许多细节使笔者受益良多。"),a("a",{attrs:{href:"https://changkun.us/archives/2017/03/217/",target:"_blank",rel:"noopener noreferrer"}},[s._v("出处 (opens new window)"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"/assets/images-1/62.png",alt:""}})])])}),[],!1,null,null,null);t.default=r.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[508],{1003:function(t,a,s){"use strict";s.r(a);var e=s(30),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"vue3-设计思想"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue3-设计思想"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#vue3-%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"}},[t._v("#")]),t._v(" Vue3 设计思想")]),t._v(" "),s("div",{staticClass:"language-JS line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Vue3 设计目标"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("vue3"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("设计目标"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v(" 更快 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Proxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("更快"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("proxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(" 更快 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Virtual Dom 重构"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("更快"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("virtual"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dom"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("重构"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.3")]),t._v(" 更快 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 更多编译优化"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("更快"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("更多编译优化"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Vue 设计思考"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("vue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("设计思考"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.1")]),t._v(" Scope"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scope"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSX")]),t._v(" vs Template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jsx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("vs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 参考"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("#_3"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("参考"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h2",{attrs:{id:"_1-vue3-设计目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-vue3-设计目标"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_1-vue3-%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87"}},[t._v("#")]),t._v(" 1. Vue3 设计目标")]),t._v(" "),s("ul",[s("li",[t._v("更小 -> tree shaking")]),t._v(" "),s("li",[s("strong",[t._v("更快")]),t._v(" "),s("ol",[s("li",[t._v("Object.defineProperty -> Proxy(使得初始化不用再递归data)")]),t._v(" "),s("li",[t._v("Virtual Dom 重构 -> 利用模板代码，确定动态和静态代码，在VDom Diff时优化")]),t._v(" "),s("li",[t._v("可跳过静态文本（无需递归进入子树循环），可跳过props对比")]),t._v(" "),s("li",[t._v("事件监听函数cache")]),t._v(" "),s("li",[t._v("更多编译优化 -> 利用模板代码，尽可能预先优化编译的代码\n"),s("ul",[s("li",[t._v("slot默认编译为函数（不存在父子组件强耦合）")]),t._v(" "),s("li",[t._v("Momomorphic vnode factory")]),t._v(" "),s("li",[t._v("Compiler-generated flags for vnode/children types（VNode带上类型）")])])])])]),t._v(" "),s("li",[s("strong",[t._v("加强TypeScript支持")])]),t._v(" "),s("li",[t._v("加强API设计一致性")]),t._v(" "),s("li",[t._v("提高自身可维护性")]),t._v(" "),s("li",[t._v("开放更多底层功能\n"),s("ul",[s("li",[t._v("响应式数据监听（即Vue2.x的Object.observer）")])])])]),t._v(" "),s("h3",{attrs:{id:"_1-1-更快-proxy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-更快-proxy"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_1-1-%E6%9B%B4%E5%BF%AB-proxy"}},[t._v("#")]),t._v(" 1.1 更快 - Proxy")]),t._v(" "),s("p",[s("strong",[t._v("Proxy减少了组件实例初始化开销")]),t._v("。在Vue2中，"),s("code",[t._v("初始化组件时")]),t._v("会对data的属性递归调用包装（Object.defineProperty）;而在Vue3中，初始化只是书写Proxy的代理handler（Proxy包装），当"),s("code",[t._v("运行时")]),t._v("getter某个属性时，才去重新Proxy包装该值，减少了初始化组件的时间。"),s("a",{attrs:{href:"https://lq782655835.github.io/blogs/vue/vue3-reactive.html#_2-reactive",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue3此部分源码讲解 (opens new window)"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("ES6 Proxy数据监听优点：")]),t._v(" "),s("ol",[s("li",[t._v("对对象进行直接监听, 可以"),s("code",[t._v("弥补Object.defineProperty无法监听新增删除属性的短板")])]),t._v(" "),s("li",[s("code",[t._v("无需再遍历对象进行设置")]),t._v("监听函数Object.defineProperty")]),t._v(" "),s("li",[t._v("可以"),s("code",[t._v("适用于Array")]),t._v(", 不需要再分成两种写法")])]),t._v(" "),s("h3",{attrs:{id:"_1-2-更快-virtual-dom-重构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-更快-virtual-dom-重构"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_1-2-%E6%9B%B4%E5%BF%AB-virtual-dom-%E9%87%8D%E6%9E%84"}},[t._v("#")]),t._v(" 1.2 更快 - Virtual Dom 重构")]),t._v(" "),s("p",[s("code",[t._v("VDOM作用, 状态（或者叫数据）驱动UI，开发者只考虑状态改变，而UI会自动变化，这就是VDOM的最大价值。")]),t._v("所以在VDOM基础上，UI不仅可以是DOM元素（web端），也可以是Native（移动端）。")]),t._v(" "),s("h4",{attrs:{id:"传统virtual-dom的性能瓶颈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传统virtual-dom的性能瓶颈"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#%E4%BC%A0%E7%BB%9Fvirtual-dom%E7%9A%84%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88"}},[t._v("#")]),t._v(" 传统Virtual DOM的性能瓶颈")]),t._v(" "),s("p",[t._v("数据变更之后，新的Virtual DOM和旧的Virtual DOM进行 patch 算法比较，并算出二者之间的差异，将差异进行修改。但是传统Virtual DOM，进行算法比对时颗粒度是组件，每个组件作为一个颗粒。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/images-1/45.png",alt:"image"}})]),t._v(" "),s("p",[t._v("虽然Vue能够保证触发更新的组件最小化，但是单个组件内部依然需要遍历该组件的整个Virtual DOM树。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/images-1/46.png",alt:"image"}})]),t._v(" "),s("p",[t._v("传统Virtual DOM的性能跟模板大小正相关，跟动态节点的数量无关。模板或者组件有多大，那么在进行数据更新时损耗的性能就有多大，但实际上，这种方式利用率很低。如上图所示，在上述template中，发生改变的地方只有message插值的部分，整体结构不变，但是数据更新的时候，比对整个template结构，这样就存在性能损耗。 所以在一些组件整个模板内只有少量动态节点的情况下，传统方法遍历存在性能的浪费。")]),t._v(" "),s("h4",{attrs:{id:"vue3-0-virtual-dom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue3-0-virtual-dom"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#vue3-0-virtual-dom"}},[t._v("#")]),t._v(" Vue3.0 Virtual DOM")]),t._v(" "),s("p",[t._v("如果要追求极致的性能，最快速的就是利用模板进行数据监听，当数据变化时，直接更新对应的DOM元素（此时可以不用VDOM，"),s("a",{attrs:{href:"https://svelte.dev/blog/virtual-dom-is-pure-overhead",target:"_blank",rel:"noopener noreferrer"}},[t._v("Svelte (opens new window)"),s("OutboundLink")],1),t._v("框架就是无VDOM）。这种方式适合开发纯template模板，因为一旦模板确定，就可以根据模板进行预编译，简单高效。")]),t._v(" "),s("p",[t._v("但这种开发方式有个弊端，无法利用js的灵活性。当开发者使用render function/JSX时，根本无法预知代码意图，所以Svelte书写上无法支持render function/JSX。Vue3所要做的：保留VDOM，兼容手写render function，同时最大化利用模版静态信息。")]),t._v(" "),s("h4",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),s("p",[s("code",[t._v("动静结合")]),t._v("，找到动态变化的部分，更新时只对比可以变化的部分，减少性能损耗。")]),t._v(" "),s("p",[s("code",[t._v("实现上，就是在模板编译时，给各个VNode带上type类型，区分不同的变更需求，然后在VDOM时对不同type的VNode更新做优化处理")]),t._v("。Vue3重构的VDOM源码讲解，会在往后单独开一篇文章讲解，这里把核心源码贴上：")]),t._v(" "),s("ul",[s("li",[t._v("Vue3 DOM算法：https://github.com/vuejs/vue-next/blob/master/packages/runtime-core/src/renderer.ts")]),t._v(" "),s("li",[t._v("Vue2 DOM算法：https://github.com/vuejs/vue/blob/dev/src/core/vdom/patch.js")])]),t._v(" "),s("h3",{attrs:{id:"_1-3-更快-更多编译优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-更快-更多编译优化"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_1-3-%E6%9B%B4%E5%BF%AB-%E6%9B%B4%E5%A4%9A%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96"}},[t._v("#")]),t._v(" 1.3 更快 - 更多编译优化")]),t._v(" "),s("p",[t._v("主要是利用模板代码的可预见性，在编译时做好编译优化")]),t._v(" "),s("ul",[s("li",[t._v("优化slots生成。slot编译时统一为函数（v-slot），父子组件slot渲染分离。")]),t._v(" "),s("li",[t._v("静态内容提取。模板不变时，diff跳过（Vue2已优化）")]),t._v(" "),s("li",[t._v("静态属性提取 "),s("img",{attrs:{src:"/assets/images-1/47.png",alt:"image"}})]),t._v(" "),s("li",[t._v("内联函数提取 "),s("img",{attrs:{src:"/assets/images-1/48.png",alt:"image"}})])]),t._v(" "),s("h2",{attrs:{id:"_2-vue-设计思考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-vue-设计思考"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_2-vue-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%80%83"}},[t._v("#")]),t._v(" 2. Vue 设计思考")]),t._v(" "),s("h3",{attrs:{id:"_2-1-scope"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-scope"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_2-1-scope"}},[t._v("#")]),t._v(" 2.1 Scope")]),t._v(" "),s("p",[t._v("框架职责，React主要聚合在底层，不会像Angular一样大包大揽，拥有Route、Form解决方案等。")]),t._v(" "),s("ol",[s("li",[t._v("Scope小\n"),s("ul",[s("li",[t._v("优点：只关注底层，不用再维护额外的解决方案，都丢给社区。上手快，因为记忆小。")]),t._v(" "),s("li",[t._v("缺点：解决方案分散（另一个维度，造就社区繁荣）")])])])]),t._v(" "),s("h3",{attrs:{id:"_2-2-jsx-vs-template"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-jsx-vs-template"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_2-2-jsx-vs-template"}},[t._v("#")]),t._v(" 2.2 JSX vs Template")]),t._v(" "),s("ol",[s("li",[t._v("JSX：\n"),s("ul",[s("li",[t._v("优点：完整的JS表达能力、视图即数据")]),t._v(" "),s("li",[t._v("缺点：VDOM难以优化，因为js动态性，无法预先优化")])])]),t._v(" "),s("li",[t._v("Template\n"),s("ul",[s("li",[t._v("优点：可以预先优化VDOM")])])])]),t._v(" "),s("h2",{attrs:{id:"_3-参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-参考"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"#_3-%E5%8F%82%E8%80%83"}},[t._v("#")]),t._v(" 3. 参考")]),t._v(" "),s("p",[t._v("以上思想主要来自Vue作者尤雨溪的多个VueConf大会视频，笔者在理解基础上进行总结，建议读者完整看原视频。")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.bilibili.com/video/av56093550?from=search&seid=17425026665332701435",target:"_blank",rel:"noopener noreferrer"}},[t._v("VueConf 2019-上海演讲视频 (opens new window)"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.bilibili.com/video/av48968552?from=search&seid=11269305592002355043",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue 3.0 进展@VueConf CN 2018 (opens new window)"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.bilibili.com/video/av80042358?from=search&seid=17425026665332701435",target:"_blank",rel:"noopener noreferrer"}},[t._v("在框架设计中寻求平衡 (opens new window)"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);